<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <title>PIXI's Hello World</title>
    <script src='/js/jquery.min.js'></script>
    <script src='js/scaleToWindow.js'></script>
    <link rel='stylesheet' href='/css/null.css' />
</head>

<body>

    <script id="pixiscript" src='/js/pixi.min.js'></script>

    <script>
        // Вспомогательная функция для загрузки скриптов
        function loadScript(src) {
            return new Promise(function(resolve, reject) {
                let script = document.createElement('script');
                script.src = src;

                script.onload = () => resolve(script);
                script.onerror = () => reject(new Error(`Ошибка загрузки скрипта ${src}`));

                document.head.append(script);
            });
        }

        // Основные настройки
        let config = {
            width: 256, // default: 800
            height: 256, // default: 600
            antialias: true, // default: false
            transparent: false, // default: false
            resolution: 1 // default: 1
        };

        let app;
        let start = (config) => {
            try {
                app = new PIXI.Application(config);
                play(app);
            } catch (e) {
                $('#pixiscript').remove();
                loadScript('/js/pixi-legacy.js')
                    .then(
                        function(result) {
                            let config6 = {
                                width: 256, // default: 800
                                height: 256, // default: 600
                                antialias: true, // default: false
                                backgroundAlpha: 1,
                                resolution: 1 // default: 1
                            };
                            app = new PIXI.Application(config6);
                            play(app);
                        },
                        function(error) {

                        }
                    );
            }
        };

        // Запуск скрипта
        start(config);

        // Основная функция
        function play(app) {

            let loader = app.loader,
                resources = app.loader.resources,
                stage = app.stage,
                Container = PIXI.Container,
                Sprite = PIXI.Sprite;

            let win = window;
            let doc = document;

            doc.body.appendChild(app.view);

            let r = app.renderer;

            r.backgroundColor = 0x061639;

            r.view.style.position = "absolute";
            r.view.style.display = "block";
            r.autoResize = true;
            r.resize(win.innerWidth, win.innerHeight);

            const container = new Container();

            stage.addChild(container);

            let setup = () => {
                //Create the sprite
                let bunny = new Sprite(resources["images/bunny.png"].texture);

                //Add the sprite to the stage
                container.addChild(bunny);

                bunny.anchor.set(0.5);


                container.addChild(bunny);

                container.x = app.screen.width / 2;
                container.y = app.screen.height / 2;

                bunny.x = container.width / 2;
                bunny.y = container.height / 2;

                container.pivot.x = container.width / 2;
                container.pivot.y = container.height / 2;

                app.ticker.add((delta) => {
                    // rotate the container!
                    // use delta to create frame-independent transform
                    bunny.rotation -= 0.01 * delta;
                });

            };
            loader
                .add("images/bunny.png")
                .load(setup);

            /*
                window.addEventListener('resize', event => {
                    scaleToWindow(renderer.view);
                });
            */
            $(window).on('resize', () => {
                scaleToWindow(renderer.view);
            });
            /*
                        doc.body.appendChild(app.view);

                        const container = new PIXI.Container();

                        app.stage.addChild(container);

                        // Create a new texture
                        const texture = PIXI.Texture.from('https://pixijs.io/examples/examples/assets/bunny.png');

                        // Create a 5x5 grid of bunnies
                        for (let i = 0; i < 25; i++) {
                            const bunny = new PIXI.Sprite(texture);
                            bunny.anchor.set(0.5);
                            bunny.x = (i % 5) * 40;
                            bunny.y = Math.floor(i / 5) * 40;
                            container.addChild(bunny);
                        }

                        // Move container to the center
                        container.x = app.screen.width / 2;
                        container.y = app.screen.height / 2;

                        // Center bunny sprite in local container coordinates
                        container.pivot.x = container.width / 2;
                        container.pivot.y = container.height / 2;

                        // Listen for animate update
                        app.ticker.add((delta) => {
                            // rotate the container!
                            // use delta to create frame-independent transform
                            container.rotation -= 0.01 * delta;
                        });
            */
        }
    </script>
</body>

</html>