<!DOCTYPE html>
<html>

<head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <meta name='msapplication-TileColor' content='#603cba'>
    <meta name='theme-color' content='#ffffff'>

    <title>Перечень подразделений ФССП</title>

    <link rel='apple-touch-icon' sizes='180x180' href='/apple-touch-icon.png'>
    <link rel='icon' type='image/png' sizes='32x32' href='/favicon-32x32.png'>
    <link rel='icon' type='image/png' sizes='16x16' href='/favicon-16x16.png'>
    <!--<link rel='manifest' href='/site.webmanifest'>-->
    <link rel='mask-icon' href='/safari-pinned-tab.svg' color='#5bbad5'>

    <script src='/js/jquery.min.js'></script>
    <script src='/js/popper.min.js'></script>
    <script src='/js/bootstrap.min.js'></script>

    <script src="/js/jquery.inputmask.min.js"></script>

    <!--<script src='/js/f4afbaa213.js' crossorigin='anonymous'></script>-->
    <script src='/js/copytoclipboard.js'></script>
    <script src='/js/share.js'></script>
    <script src='/js/bootstrap4-toggle.min.js'></script>
    <script src='/js/jquery.history.js'></script>


    <script src='/js/math.min.js'></script>
    <script src="/js/plotly-latest.min.js"></script>

    <link rel='stylesheet' href='/css/bootstrap4-toggle.min.css' />
    <link rel='stylesheet' href='/css/bootstrap.min.css' />
    <link rel='stylesheet' href='/css/style.css' />
    <link rel='stylesheet' href='/css/yashare2.css' />
    <link rel='stylesheet' href='/css/gutenberg.min.css' media='print' />
    <link rel='stylesheet' href='/css/print.css' media='print' />

	<script src="/js/d3.v6.min.js"></script>
	<script src="/js/papaparse.min.js"></script>
	<script src="/js/anime.min.js"></script>

    <script type='module'>

    </script>
	<style>
	.square,
	.circle {
	  pointer-events: none;
	  position: relative;
	  width: 28px;
	  height: 28px;
	  margin: 1px;
	  background-color: currentColor;
	  font-size: 14px;
	}
	</style>
</head>

<body>
    <div id="container" class="container-fluid">
	
		<div class="square el" style=""></div>
		<div id="tt" class="container">
		</div>
		<table id="ll">
			<thead><tr><td></td></tr></thead>
			<tbody></tbody>
		</table>
	</div>
    <!-- The Modals -->
    <!-- 1 -->
    <div class="modal fade" id="modallink">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Копировать ссылку</h4>
                    <button type="button" class="close" data-dismiss="modal">?</button>
                </div>

                <!-- Modal body -->
                <div id="link" class="modal-body text-center container">
                    <div class="form-group">
                        <label for="link">Ссылка:</label>
                        <textarea class="form-control" rows="5" id="link" disabled="disabled"></textarea>
                    </div>
                    <button id="btncopylink" type="button" class="btn btn-primary">Копировать</button>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Отмена</button>
                </div>

            </div>
        </div>
    </div>
    <!-- 2 -->
    <div class="modal fade" id="modalshare">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Поделиться ссылкой</h4>
                    <button type="button" class="close" data-dismiss="modal">?</button>
                </div>

                <!-- Modal body -->
                <div id="icons" class="modal-body text-center container">
                    <div class="ya-share2" data-bare data-curtain data-size="l" data-shape="round" data-services="vkontakte,facebook,odnoklassniki,messenger,telegram,twitter,viber,whatsapp,pinterest,collections,moimir,skype,tumblr,evernote,linkedin,lj,blogger,delicious,digg,reddit,pocket,qzone,renren,sinaWeibo,surfingbird,tencentWeibo"></div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Отмена</button>
                </div>

            </div>
        </div>
    </div>
    <!-- 3 -->
    <div class="modal fade" id="modalcogs">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Настройки</h4>
                    <button type="button" class="close" data-dismiss="modal">?</button>
                </div>

                <!-- Modal body -->
                <div id="settingsbody" class="modal-body text-center container">
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Отмена</button>
                </div>

            </div>
        </div>
    </div>

	<script>
	/*
		const inputElement = document.getElementById("input");
		inputElement.addEventListener("change", handleFiles, false);
		function handleFiles() {
		  const fileList = this.files; // now you can work with the file list 
		  
		  var numFiles = fileList.length;
		  var compareByRegionCode = function (a, b) { // <-G
				return a[0] < b[0]?-1:1;
			};
		  
		  for (var i = 0, numFiles = fileList.length; i < numFiles; i++) {
			  var file = fileList[i];
			  
				Papa.parse(file, {
					complete: displayCSV
				});//Papa.parse

			}
		  
		}*/
		//Перечень управлений
		//https://opendata.fssp.gov.ru/7709576929-tolist
		//Перечень отделов
		//https://opendata.fssp.gov.ru/7709576929-osp
		//https://opendata.fssp.gov.ru/7709576929-osp/data-20210226-structure-20160226.csv
		
    var tween = anime({
			targets: '.el',
			translateX: window.innerWidth-28,
			delay: function(el, i) { return i * 200; },
			direction: 'alternate',
			loop: true,
			easing: 'easeInOutSine'
		});
		
		
		(async ()=>{
		  
		  let f = "https://opendata.fssp.gov.ru/7709576929-osp/data-20210226-structure-20160226.csv";
		  let f2 = "new.csv";
		  
		  try {
		    let response = await fetch(f2);
		    let text = await response.text();
		    //alert(text.slice(0,80));
		    Papa.parse(text,{
		      complete: displayCSV
		    });
		  } catch(err) {
		    alert(err);
		  }
		})()
		
		
		/*
		Papa.parse("./new.csv", {
					download: true,
					complete: emptyFunc
				});
		*/
		function emptyFunc(results){}
		function displayCSV(results) {
tween.pause();
		  anime.set({
		    targets: ".el",
		    backgroundColor: "#777"
		  });
		  
						var titles = [
						"код региона",
						"код подразделения",
						"наименование подразделения",
						"почтовый адрес",
						"ФИО начальника",
						"телефон",
						"факс",
						"телефон для справок",
						"телефон для справок 2",
						"время работы",
						"территория обслуживания"
						];
						var data = results.data;
						
						d3.selectAll(".line").remove();
						
						d3.select("table").attr("class","table table-striped");
						d3.select("table thead").attr("class","table table-dark");
						
						d3.select("thead tr").selectAll("td").data(titles).text((d)=>d);
						d3.select("thead tr").selectAll("td").data(titles).enter().append("td").text((d)=>d);
						d3.select("thead tr").selectAll("td").data(titles).exit().remove();
						var lines = [];
						data.forEach((line,i)=>{
							if (i!=0 && line[0]!="") {
								lines.push(line);
							}
						});
						
						function compareNumericByRegionCode(a, b, i=0) {
							if (Number(a[i]) > Number(b[i])) return 1;
							if (Number(a[i]) == Number(b[i])) return 0;
							if (Number(a[i]) < Number(b[i])) return -1;
						}
						function compareNumericByTerritorialAgency(a, b, i=1) {
							if (Number(a[i]) > Number(b[i])) return 1;
							if (Number(a[i]) == Number(b[i])) return 0;
							if (Number(a[i]) < Number(b[i])) return -1;
						}


						var lines = lines.sort(compareNumericByTerritorialAgency);
						lines = lines.sort(compareNumericByRegionCode);
						


						var rows = d3.select("tbody")
							.selectAll("tr").data(lines);
							
										
						var rows_enter = rows	
							.enter().append("tr");
						
						rows.exit().remove();
						
						var entries = rows_enter.selectAll("td");
						var entries_data = entries.data( function(d, i) { return d; })
						var dataenter = entries_data.enter();
						dataenter.append("td").text((d)=>d);
						
						tween.pause();


		}
	</script>
</body>


</html>
